#!/bin/sh
# Pre-push hook for @boring-financial/assets package
# Runs linting, tests, and build before pushing to ensure code quality

echo "🔍 Running pre-push checks for @boring-financial/assets..."

# Check if we're pushing to a new branch (no upstream)
if ! git rev-parse --abbrev-ref @{upstream} >/dev/null 2>&1; then
  echo "📤 Pushing branch to remote..."
elif ! git status | grep -q "Your branch is ahead"; then
  echo "❌ Error: No changes to push. Your branch is not ahead of the remote."
  exit 1
fi

# Run linting
echo "🔧 Running linter..."
pnpm lint
if [ $? -ne 0 ]; then
  echo "❌ Linting failed. Please fix linting errors before pushing."
  exit 1
fi

# Run tests
echo "🧪 Running tests..."
pnpm test
if [ $? -ne 0 ]; then
  echo "❌ Tests failed. Please fix failing tests before pushing."
  exit 1
fi

# Run build
echo "🏗️  Running build..."
pnpm build
if [ $? -ne 0 ]; then
  echo "❌ Build failed. Please fix build errors before pushing."
  exit 1
fi

echo "✅ All pre-push checks passed! Pushing to remote..."
