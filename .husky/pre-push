#!/bin/sh
# Pre-push hook for @boring-financial/assets package
# Runs linting, tests, and build before pushing to ensure code quality

echo "ğŸ” Running pre-push checks for @boring-financial/assets..."

# Check if we're pushing to a new branch (no upstream)
if ! git rev-parse --abbrev-ref @{upstream} >/dev/null 2>&1; then
  echo "ğŸ“¤ Pushing branch to remote..."
elif ! git status | grep -q "Your branch is ahead"; then
  echo "âŒ Error: No changes to push. Your branch is not ahead of the remote."
  exit 1
fi

# Run linting
echo "ğŸ”§ Running linter..."
pnpm lint
if [ $? -ne 0 ]; then
  echo "âŒ Linting failed. Please fix linting errors before pushing."
  exit 1
fi

# Run tests
echo "ğŸ§ª Running tests..."
pnpm test
if [ $? -ne 0 ]; then
  echo "âŒ Tests failed. Please fix failing tests before pushing."
  exit 1
fi

# Run build
echo "ğŸ—ï¸  Running build..."
pnpm build
if [ $? -ne 0 ]; then
  echo "âŒ Build failed. Please fix build errors before pushing."
  exit 1
fi

echo "âœ… All pre-push checks passed! Pushing to remote..."
